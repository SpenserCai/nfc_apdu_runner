# APDU Response Decoder

APDU Response Decoder is a tool for parsing and displaying `.apdures` files generated by the Flipper Zero NFC APDU Runner application.

## Features

- Support for loading `.apdures` files from local storage
- Support for loading `.apdures` files directly from Flipper Zero devices (via SD card mounting or serial communication)
- Support for custom decoding format templates
- Beautiful colored output

## Installation

### Install Dependencies

```bash
go get go.bug.st/serial
go get go.bug.st/serial/enumerator
go get github.com/spf13/cobra
go get github.com/fatih/color
```

### Build

```bash
go build -o response_decoder
```

## Usage

### Load from Local File

```bash
./response_decoder -f path/to/file.apdures
```

### Load from Flipper Zero Device (SD Card Mount)

```bash
./response_decoder -d
```

### Load from Flipper Zero Device (Serial Communication)

```bash
./response_decoder -d -s
```

If you need to specify a serial port:

```bash
./response_decoder -d -s -p /dev/tty.usbmodem123456
```

### Use Custom Decoding Format

```bash
./response_decoder -f file.apdures --decode-format path/to/format.apdufmt
```

## Decoding Format Templates

A decoding format template is a text file that defines how to parse and display APDU response data. The first line of the template file is the format name, and subsequent lines are decoding rules.

For example, a PBOC format template:

```
PBOC
Card Number: {hex(O[1][10:18])}
Name: {hex(O[2][10:20], "utf-8")}
Balance: {hex(O[3][10:18])} Yuan
Valid Until: 20{O[4][10:12]}-{O[4][12:14]}
Transaction Record: {hex(O[5][10:30])}
```

### Template Syntax

- `I[n]`: The nth input command
- `O[n]`: The nth output response
- `hex(data)`: Convert a hexadecimal string to readable text
- `hex(data, "utf-8")`: Convert a hexadecimal string to text using UTF-8 encoding
- `O[n]TAG(tag)`: Extract the value of the specified TLV tag from the nth output response
- `O[n]TAG(tag, "encoding")`: Extract the value of the specified TLV tag from the nth output response and convert it to text using the specified encoding

### TLV Parsing

This tool supports parsing TLV (Tag-Length-Value) data structures commonly used in EMV and other smart cards. The TLV parsing functionality allows you to extract values for specific tags directly from APDU responses without manually calculating offsets.

Supported encoding types:
- `utf-8`: UTF-8 encoding
- `ascii`: ASCII encoding
- `numeric`: Numeric encoding (such as BCD code)

#### TLV Template Example

EMV format template:

```
EMV Card Information
Card Number: {O[1]TAG(5A), "numeric"}
Cardholder Name: {O[2]TAG(5F20), "utf-8"}
Expiration Date: {O[2]TAG(5F24), "numeric"}
Currency Code: {O[3]TAG(9F42)}
Balance: {O[3]TAG(9F79)}
Transaction Log: {O[4]TAG(9F4D)}
Application Label: {O[0]TAG(50), "ascii"}
```

## License

GNU General Public License v3.0 (GPL-3.0) 